# Operational Resilience (Core Infrastructure)

**目的**: LangGraph と Gemini 3 Flash を核としたシステムの安定稼働、効率的なリソース消費、および「鉄の掟」に準拠した開発を保証する。

## 1. LLM 運用 (Gemini Strategy)
*   **Gemini 3 Flash 専念**: モデルの変更は原則禁止。コンテキストウィンドウの広さを活かし、膨大な一次情報を一度に処理せよ。
*   **キャッシュ最適化**: システムプロンプトや知識ベースを先頭に配置し、暗黙的キャッシュを最大限活用してレイテンシとコストを削減せよ。
*   **JSON モード**: 構造化データ出力には必ず `responseMimeType: "application/json"` を使用し、`src/core.ts` の `parseLlmJson` で安全にパースせよ。

## 2. ワークフロー制御 (LangGraph Strategy)
*   **最小ステート**: 全チャット履歴を保持せず、`summary` や `essence` に圧縮してリレーせよ。
*   **Resume ロジック**: 途中で失敗した実行を、チェックポイントから正確に再開（Resume）できる設計を維持せよ。副作用のある操作は冪等性を担保せly。

## 3. エラーと安定性 (Fail Fast & Throttling)
*   **Fail Fast (掟5)**: `try-catch` でエラーを飲み込むな。予期せぬ状態は即座にクラッシュさせ、問題を表面化させよ。
*   **スマート・スロットリング**: 指数関数的バックオフとジッターを使用し、APIレート制限を賢く回避せよ。

## 4. 鉄の掟の適用
*   **最小化 (掟1)**: コード量は罪。冗長なロジックは `src/core.ts` に集約し、各エージェントは機能を最小限に絞れ。
*   **any禁止 (掟8)**: 型安全性はシステムの命。厳密な型定義を徹底せよ。
