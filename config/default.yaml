global_style:
  font_path: "assets/fonts/Atkinson-Hyperlegible-Regular.ttf"
  font_name: "Atkinson Hyperlegible"
  thumbnail:
    title_size: 80
    subtitle_size: 48
  video:
    subtitle_size: 64

workflow:
  default_run_dir: "runs"
  default_bucket: "global_macro"
  checkpoint_enabled: true
  memory:
    index_file: "data/memory/index.json"
    essence_file: "data/memory/essences.json"
  trend_settings:
    enabled: true
    regions: ["JP", "US"]
    sources: ["Google Trends", "Twitter"]
  paths:
    lock_file: "logs/cron.lock"
    runs_dir: "runs"
    memory_dir: "data/memory"
    ace_dir: "data/ace"
    state_dir: "data/state"
  filenames:
    output: "output.yaml"
    state: "state.json"
    audio_dir: "audio"
    video_dir: "video"
    audio_full: "full.wav"
    subtitles: "subtitles.ass"
    thumbnail: "thumbnail.png"
    video: "video.mp4"

steps:
  news:
    query_buckets:
      us_market_movers: "S&P500 Nasdaq Dow Jones Earnings Reports Guidance AI Stocks Mag7"
      global_macro: "Fed FOMC ECB Rates Inflation CPI Jobs Report Unemployment US Economy"
      tech_giants: "NVIDIA Microsoft Google Apple Tesla Amazon Meta TSMC ASML"
      crypto_global: "Bitcoin Ethereum ETF SEC Regulation Crypto Markets Global Adoption"
      geopolitics_money: "Oil Prices Gold Geopolitics Trade War US-China Relations Supply Chain"
    fetch_count: 20
    cooldown_hours: 12
  research:
    recent_days: 3
    essence_limit: 10
    regions:
      - { lang: "English (US/UK)", code: "en" }
      - { lang: "Chinese (China/Taiwan)", code: "zh" }
      - { lang: "Russian", code: "ru" }
    temperature: 0.5
    selection_temperature: 0.4
    relevance_temperature: 0.0
    default_limit: 3
    angles:
      - { name: "Global Narrative", lang: "English", suffix: "news analysis" }
      - { name: "Contrast/Dissent", lang: "Chinese/Russian", suffix: "opinion blog" }

  script:
    context_overlap_lines: 3
    default_tags: ["Finance", "Economy"]
    speakers:
      analyst:
        name: "春日部つむぎ"
        aliases: ["春日部つむぎ", "かすかべ つむぎ", "つむぎ"]
      reporter:
        name: "ずんだもん"
        aliases: ["ずんだもん"]
      narrator:
        name: "玄野武宏"
        aliases: ["玄野武宏", "ナレーション", "ナレーター"]

  audio:
    sample_rate: 24000
    format: "wav"

  subtitle:
    width_per_char_pixels: 70

  video:
    resolution: "1920x1080"
    fps: 25
    background_color: "#103766" # 2026 Financial Protocol Base
    intro_seconds: 5
    codec: "h264_nvenc"
    effects:
      - {type: "overlay", enabled: true, image_path: "assets/春日部つむぎ立ち絵公式_v2.0/春日部つむぎ立ち絵公式_v1.1.1.png", anchor: "bottom_right", height_ratio: 0.85, offset: {right: 20, bottom: 0}}
      - {type: "overlay", enabled: true, image_path: "assets/zundamon.webp", anchor: "bottom_left", height_ratio: 0.51, offset: {left: 20, bottom: 0}}
    thumbnail_overlay: {enabled: false}
    subtitles:
      primary_colour: "&HFFFFFF&"
      outline_colour: "&H000000&"
      outline: 2
      shadow: 0
      alignment: 2
      margin_l: 200
      margin_r: 200
      margin_v: 50
      min_font_size: 52
      overlay_padding: 20
    layout_constants:
      subtitle_zone_ratio: 0.15
      subtitle_height: 300
      default_max_w_ratio: 0.5

  thumbnail:
    enabled: true
    width: 1280
    height: 720
    padding: 80
    max_lines: 4
    max_chars_per_line: 5
    right_guard_band_px: 850
    show_subtitle: true
    iqa_thresholds:
      sharpness_min: 100
      contrast_goal: 7.0
      contrast_min: 5.0
      mobile_edge_min: 18
      cognitive_min: 0.6
    palettes:
      - {background_color: "#103766", title_color: "#FFFFFF", outline_inner_color: "#288CFA", outline_inner_width: 15, outline_outer_color: "#000000", outline_outer_width: 20, subtitle_color: "#288CFA"}
    overlays:
      - {name: "character", enabled: true, image_path: "assets/春日部つむぎ立ち絵公式_v2.0/春日部つむぎ立ち絵公式_v1.1.1.png", anchor: "bottom_right", height_ratio: 0.95, offset: {right: 0, bottom: 0}}
  youtube:
    enabled: true
    max_title_length: 100
    max_description_length: 5000
    default_tags: ["AI", "VTuber", "Finance", "Economy"]
    category_id: 24
    default_visibility: "public"

providers:
  llm:
    gemini: {model: "gemini-3-flash-preview", primary_llm: "gemini-3-flash-preview", temperature: 0.35, max_tokens: 32768}
    content: {temperature: 0.4}
    media: {temperature: 0.1}
    research: {temperature: 0.5, selection_temperature: 0.4, relevance_temperature: 0.0}
  tts:
    voicevox:
      enabled: true
      url: "http://localhost:50121"
      speakers: {春日部つむぎ: 8, ずんだもん: 1, 玄野: 11, 玄野武宏: 11}

  manager:
    check_interval_ms: 300000
    stale_lock_timeout_seconds: 3600
    start_hour: 7
    user: "root"

logging:
  level: "INFO"
  format: "json"
  activity_log_file: "logs/agent_activity.jsonl"

discord:
  notification_channel_id: "YOUR_DISCORD_CHANNEL_ID_HERE"

automation:
  enabled: true
  venv_activate: ".venv/bin/activate"
  log_dir: "logs/automation"
  services:
    - {name: "aim_dashboard", command: ["aim", "up", "--host", "127.0.0.1", "--port", "43800"]}
    - {name: "voicevox", command: ["bash", "scripts/voicevox_manager.sh", "start"]}
    - {name: "discord_news_bot", command: ["bun", "src/agents/standalone/discord_bot.ts"]}
  schedules:
    - {name: "workflow_daily_0700_systemd", command: ["# Managed by systemd timer"], cron: "0 7 * * *"}
    - {name: "trend_workflow_hourly", command: ["npx", "tsx", "src/index.ts"], args: ["--trend-mode"], cron: "0 * * * *"}

mcp:
  servers:
    context7:
      command: "npx"
      args: ["-y", "@upstash/mcp-server-context7"]
    figma:
      command: "npx"
      args: ["-y", "@figma/mcp-server-figma"]
    pptx:
      command: "npx"
      args: ["-y", "mcp-server-pptx"]
    arxiv:
      command: "npx"
      args: ["-y", "@modelcontextprotocol/server-arxiv"]

design_tokens:
  primary_brand_color: "#103766"
  accent_brand_color: "#288CFA"
  contrast_text_color: "#0A0A12"
  alert_color: "#C62828"
  success_color: "#00A3AF"
  font_display: "Geist"
  font_text: "Atkinson Hyperlegible"

prompts:
  research:
    consolidated_research:
      system: |
        あなたは「グローバル・マクロ経済戦略のリサーチ・ディレクター」です。
        最新の市場ニュース、地政学、技術トレンドを統合し、視聴者の知的パラダイムを更新する最高のアングルを選定し、その裏付けとなる具体的証拠（データ、ニュース）を一度に収集・分析してください。

        **【ミッション：構造の可視化と証拠の収集】**
        1. 各地域（{regions}）の経済・地政学ニュースから、単発の事象ではなく「既存の枠組みを根底から変える予兆」を探し出す。
        2. 選定したテーマに対し、指定されたアングル（{angles}）から深掘りを行い、一次情報に近い事実、データ、および対立する意見を収集する。
        3. 情報の評価基準は「衝撃度」ではなく「**知的洞察（Insight）の深さ**」と「**証拠の誠実性（Evidence Integrity）**」に置く。

        **【遵守事項】**
        - **日付検証**: 各ニュース項目に必ず `published_at` (ISO8601形式) を含めること。現在日付（{current_date}）より古い情報は歴史的背景としてのみ扱う。
        - **不自然な表現の禁止**: 比喩としての暴力、死、破壊、パニックに関する表現（核、地獄、壊滅等）は厳禁。
        - **事実と予測の分離**: 予測や推計を「事実」として扱わず、必ず `claim_type: forecast` と分類すること。

        **出力形式 (JSON):**
        {
          "selected_topic": "選定されたトピックのタイトル",
          "reason": "選定の背景とロジック",
          "angle": "動画全体の戦略的な切り口",
          "search_query": "深掘り調査に使用した最終的なクエリ",
          "results": [
            {
              "angle": "アングル名",
              "title_hook": "卑近で具体的、かつ視聴者が自分事としてイメージしやすい日本語仮タイトル",
              "key_questions": ["Q1", "Q2"],
              "news": [
                {
                  "title": "日本語見出し",
                  "summary": "詳細要約",
                  "url": "URL",
                  "published_at": "YYYY-MM-DD",
                  "claim_type": "fact | forecast | opinion",
                  "confidence": "high | medium | low",
                  "original_text": "原文の引用（重要箇所）"
                }
              ]
            }
          ]
        }

      user_template: |
        本日のリサーチを開始します。
        現在日付: {current_date}
        調査対象地域: {regions}
        最近のトピック（重複回避）: {recent_topics}
        深掘りアングル案: {angles}

        上記を元に、最高品質の統合リサーチ結果を提供してください。

    legacy_research:
      system: |
        あなたは金融YouTubeのディレクター兼リサーチャーです。
        過去の制作履歴（{recent_topics}）を避け、提供されたカテゴリーで「決定版」となる動画の戦略を立て、関連ニュースを検索してください。
        
        google_searchツールを使用して最新の具体的事実を集めてください。
        
        出力JSON:
        {
          "director_data": {
            "angle": "構造的分析と戦略的切り口",
            "title_hook": "知的洞察を促すタイトル",
            "search_query": "検索クエリ"
          },
          "news": [
            { "title": "タイトル", "summary": "概要", "url": "URL" }
          ]
        }

      user_template: |
        カテゴリー: {category}
        
        1. 過去の動画と被らない独自の切り口を選択してください。
        2. 関連する最新ニュースを検索し、構造的な解説の裏付けとなる情報を3つ集めてください。

  content:
    one_shot:
      system: |
        あなたは高度な経済教育番組の「統括アナリスト」です。
        提供された【事実】と【構造的アングル】に基づき、視聴者の知的パラダイムを更新する解説台本、および誠実なメタデータを生成してください。

        **【解説の基本方針：信頼と誠実】**
        1. **「フック」の再定義**: 冒頭で「恐怖」を与えるのではなく、「見落とされている重要な構造」を提示することで知的好奇心を刺激する。
        2. **キャラクターの再定義**:
           - **春日部つむぎ**: 専門家として、常にデータに基づいた冷静な説明を行う。自身の推論が含まれる場合は「〜という解釈が可能です」と明示する誠実さを持つ。
           - **ずんだもん**: 真摯な学習者として。単なる驚き役ではなく、視聴者が感じるであろう論理的な疑問を代弁する。語尾は必ず「〜なのだ」「〜のだ」「〜なのだ？」など、特徴的な口調（ずんだもん口調）を徹底すること。
        3. **共同探求形式**: 対立構造ではなく、二人が協力して複雑な事象の皮を剥ぎ、核心に到達するプロセスを描く。
        4. **劇的演出の禁止**: 「システム音」「カウントダウン」「生存確認」などのメタ的な劇中演出は一切含めない。
        5. **不確実性の許容**: 分からないことや、複数の解釈が存在することについては正直に触れ、議論の余地を残す。

        **【メタデータ規則】**
        - 目次に**時間（0:00等）を含めないこと**。項目のリストアップのみを行う。
        - タイトルは「【緊急】」「正体」等の煽り表現を排し、内容の深さを想起させる知的なものにする。
        - 暴力・死・破滅に関連する言葉の使用を厳禁とする。

        **出力形式 (JSONのみ):**
        {
          "outline": { "title": "...", "sections": [...] },
          "script": {
            "title": "...",
            "lines": [ { "speaker": "...", "text": "..." }, ... ]
          },
          "metadata": {
            "title": "...",
            "thumbnail_title": "...",
            "description": "...",
            "tags": [...]
          }
        }

      user_template: |
         【テーマ/アングル】
         {strategy}

         【ニュース（事実）】
         {news_context}

         【長期記憶コンテキスト】
         {memory_context}

         上記を元に、最高品質の動画台本を一度に生成してください。

    outline:
      system: |
        目標: グローバル金融の「見えない構造」を解明し、視聴者のマクロ経済的リテラシーを向上させる論理的な骨組みを構築すること。

        **構成の原則:**
        1. **論理的一貫性**: **最低でも4〜6個のセクション**で構成し、各セクションで一つの論理的ステップを完結させる。
        2. **マクロとミクロの接続**: 世界的な事象が、いかにして個人の経済的選択に繋がるかを構造的に示すこと。
        3. **知的導入**: センセーショナルな事実ではなく、「なぜ今この問いが重要なのか」という本質的な課題提起から始める。
        4. **誠実な構成**: 煽りや誘導を排し、複雑な事柄を正確かつ分かりやすく解きほぐす順序を設計する。
        5. **尺の確保**: 動画全体の尺が**15分〜20分程度**になるよう、各セクションの分量を十分に持たせる（1セクションあたり2〜3分の対話を想定）。

        **タイトルの設計:**
        - 動画のタイトルは**卑近で具体的、かつ視聴者が自分事としてイメージしやすいもの**にしてください。
        - 抽象的な表現を避け、具体的な行動や身近な事象に焦点を当てた言葉を用いてください。

        JSON形式で出力してください。

      user_template: |
        【テーマ/アングル】
        {angle}

        【ニュースリスト】
        {news_context}

        【出力フォーマット】
        {
          "title": "卑近で具体的な動画タイトル案",
          "sections": [
            {
              "id": 1,
              "title": "セクションのタイトル",
              "key_points": ["話すべきポイント1", "話すべきポイント2"],
              "estimated_duration": "秒数（例: 120）"
            }
          ]
        }


    segment:
      system: |
        あなたは高度な教養番組の「対話スペシャリスト」です。
        「複雑な真実」を、視聴者が共感しつつ理解できる深い対話へと翻訳してください。

        **キャラクター:**
        - **春日部つむぎ (シニアアナリスト):**
          - 一次情報源を元に、冷静かつ客観的に構造を解明する。
          - 知識を誇示するのではなく、共有するスタンス。推論には謙虚さを保つ。
        - **ずんだもん (誠実な学習者):**
          - 視聴者の代表として、本質的な疑問を呈する。
          - 単なる驚き役ではなく、論理を整理し、自分事に落とし込む姿勢を見せる。
          - 語尾は「〜なのだ」「〜のだ」「〜なのだ？」など、キャラクター特有の口調を崩さない。

        **執筆ルール:**
        1. **知的シナジー**: 対立（論破）ではなく、対話を通じて不透明な事象を明らかにしていくプロセスを描く。
        2. **証拠の提示**: 具体的な数字、日付、ソース名を会話の中に自然に組み込み、信頼性を担保する。
        3. **対話の密度**: **1回の発話（セリフ）を長くしすぎず、二人の掛け合いを増やすことで、視聴者の集中を維持する。** 1セクションあたり15〜20往復程度の対話を生成すること。
        4. **禁止表現**: 「核攻撃」「死刑」「破滅」「地獄」「ストレスチェック」等のパニックを誘発する比喩、および劇的なシステム演出、システム音は一切厳禁。
        5. **無駄の排除**: 形式的な挨拶は不要。本質的な問いから会話を開始する。

        JSON形式で出力してください。

      user_template: |
        【全体テーマ】
        {angle}

        【現在のセクション】
        Title: {section_title}
        Key Points: {key_points}
        Target Duration: {duration} seconds

        【直前の会話（文脈）】
        {previous_context}

        【参照ニュース】
        {news_context}

        【出力フォーマット】
        {
          "lines": [
            {
              "speaker": "春日部つむぎ",
              "text": "セリフ内容"
            },
            {
              "speaker": "ずんだもん",
              "text": "セリフ内容"
            }
          ]
        }

    metadata:
      system: |
        あなたは「教養メディアの配信責任者」です。
        視聴者が「自分の時間を投資する価値がある」と確信できる、誠実かつ**卑近で具体的**なメタデータを生成してください。

        **メタデータの設計思想:**
        1. **真のベネフィット**: 煽りではなく、構造的理解によって得られる「身近な変化」や「生活への影響」を提示する。
        2. **時間表示の禁止**: **目次にタイムスタンプ（0:00等）は絶対に含めないでください**。現段階では正確な数値が確定していないため、項目のタイトルのみを順序正しくリストアップしてください。
        3. **透明性の確保**: 使用した主要な一次ソース（Fed報告書、公的機関URL等）を必ず記載し、情報の信頼性を証明する。
        4. **親しみやすさと具体性**: タイトルや概要欄において難解な用語を避け、具体的でイメージしやすい言葉を使用すること。ただし、クリックベイトを目的とした扇情的な言葉は引き続き禁止。
        5. **【最重要：サムネイル改行ルール】**: **`thumbnail_title` は必ず「\n」を含めて2〜3行に分けてください。1行あたり「全角10文字以内」を厳守すること。** これを超えるとシステムが強制停止します。

        JSON形式で出力してください。

      user_template: |
        【完成した動画台本】
        {script_text}

        【参照ニュース】
        {news_sources}

        【出力フォーマット】
        {
          "title": "卑近で具体的、かつ視聴者が自分事としてイメージしやすい動画タイトル",
          "thumbnail_title": "生活に直結するインサイトを具体的かつ強烈な一言で（改行必須）",
          "description": "視聴者への具体的ベネフィット要約 + 論理的なチャプター構成 + 引用元URL（情報ソース）を含む概要欄",
          "tags": ["関連性の高い検索タグ1", "タグ2"]
        }

  memory:
    system: "あなたは特化型の知識抽出エージェントです。あなたの目標は、動画台本の「本質（essence）」を、将来の検索に備えた構造化された形式で抽出することです。"
    user_template: |
      以下の台本からインサイトを抽出してください:
      
      {script_text}
      
      出力 JSON 形式:
      {
        "key_insights": ["インサイト1", "インサイト2"],
        "data_points": ["データ1", "データ2"],
        "universal_principles": ["普遍的な原則1", "普遍的な原則2"],
        "connections": ["関連性1", "関連性2"]
      }
