global_style:
  font_path: "assets/fonts/Atkinson-Hyperlegible-Regular.ttf"
  font_name: "Atkinson Hyperlegible"
  thumbnail:
    title_size: 80
    subtitle_size: 48
  video:
    subtitle_size: 64

workflow:
  default_run_dir: "runs"
  default_bucket: "global_macro"
  checkpoint_enabled: true
  memory:
    index_file: "data/memory/index.json"
    essence_file: "data/memory/essences.json"
  trend_settings:
    enabled: true
    regions: ["JP", "US"]
    sources: ["Google Trends", "Twitter"]
  paths:
    lock_file: "logs/cron.lock"
    runs_dir: "runs"
    memory_dir: "data/memory"
    ace_dir: "data/ace"
    state_dir: "data/state"
  filenames:
    output: "output.yaml"
    state: "state.json"
    audio_dir: "audio"
    video_dir: "video"
    audio_full: "full.wav"
    subtitles: "subtitles.ass"
    thumbnail: "thumbnail.png"
    video: "video.mp4"

steps:
  news:
    query_buckets:
      us_market_movers: "S&P500 Nasdaq Dow Jones Earnings Reports Guidance AI Stocks Mag7"
      global_macro: "Fed FOMC ECB Rates Inflation CPI Jobs Report Unemployment US Economy"
      tech_giants: "NVIDIA Microsoft Google Apple Tesla Amazon Meta TSMC ASML"
      crypto_global: "Bitcoin Ethereum ETF SEC Regulation Crypto Markets Global Adoption"
      geopolitics_money: "Oil Prices Gold Geopolitics Trade War US-China Relations Supply Chain"
    fetch_count: 20
    cooldown_hours: 12
  research:
    recent_days: 3
    essence_limit: 10
    regions:
      - { lang: "English (US/UK)", code: "en" }
      - { lang: "Chinese (China/Taiwan)", code: "zh" }
      - { lang: "Russian", code: "ru" }
    temperature: 0.5
    selection_temperature: 0.4
    relevance_temperature: 0.0
    default_limit: 3
    angles:
      - { name: "Global Narrative", lang: "English", suffix: "news analysis" }
      - { name: "Contrast/Dissent", lang: "Chinese/Russian", suffix: "opinion blog" }

  script:
    context_overlap_lines: 3
    default_tags: ["Finance", "Economy"]
    speakers:
      analyst:
        name: "春日部つむぎ"
        aliases: ["春日部つむぎ", "かすかべ つむぎ", "つむぎ"]
      reporter:
        name: "ずんだもん"
        aliases: ["ずんだもん"]
      narrator:
        name: "玄野武宏"
        aliases: ["玄野武宏", "ナレーション", "ナレーター"]

  audio:
    sample_rate: 24000
    format: "wav"

  subtitle:
    width_per_char_pixels: 70

  video:
    resolution: "1920x1080"
    fps: 25
    background_color: "#103766" # 2026 Financial Protocol Base
    intro_seconds: 5
    codec: "h264_nvenc"
    effects:
      - {type: "overlay", enabled: true, image_path: "assets/春日部つむぎ立ち絵公式_v2.0/春日部つむぎ立ち絵公式_v1.1.1.png", anchor: "bottom_right", height_ratio: 0.85, offset: {right: 20, bottom: 0}}
      - {type: "overlay", enabled: true, image_path: "assets/zundamon.webp", anchor: "bottom_left", height_ratio: 0.51, offset: {left: 20, bottom: 0}}
    thumbnail_overlay: {enabled: false}
    subtitles:
      primary_colour: "&HFFFFFF&"
      outline_colour: "&H000000&"
      outline: 2
      shadow: 0
      alignment: 2
      margin_l: 200
      margin_r: 200
      margin_v: 50
      min_font_size: 52
      overlay_padding: 20

  thumbnail:
    enabled: true
    width: 1280
    height: 720
    padding: 80
    max_lines: 4
    max_chars_per_line: 5
    right_guard_band_px: 850
    show_subtitle: true
    palettes:
      - {background_color: "#103766", title_color: "#FFFFFF", outline_inner_color: "#288CFA", outline_inner_width: 15, outline_outer_color: "#000000", outline_outer_width: 20, subtitle_color: "#288CFA"}
    overlays:
      - {name: "character", enabled: true, image_path: "assets/春日部つむぎ立ち絵公式_v2.0/春日部つむぎ立ち絵公式_v1.1.1.png", anchor: "bottom_right", height_ratio: 0.95, offset: {right: 0, bottom: 0}}

providers:
  llm:
    gemini: {model: "gemini-3-flash-preview", primary_llm: "gemini-3-flash-preview", temperature: 0.35, max_tokens: 32768}
    content: {temperature: 0.4}
    media: {temperature: 0.1}
    research: {temperature: 0.5, selection_temperature: 0.4, relevance_temperature: 0.0}
  tts:
    voicevox:
      enabled: true
      url: "http://localhost:50121"
      speakers: {春日部つむぎ: 8, ずんだもん: 1, 玄野: 11, 玄野武宏: 11}

  manager:
    check_interval_ms: 300000
    stale_lock_timeout_seconds: 3600
    start_hour: 7
    user: "root"

logging:
  level: "INFO"
  format: "json"
  activity_log_file: "logs/agent_activity.jsonl"

discord:
  notification_channel_id: "YOUR_DISCORD_CHANNEL_ID_HERE"

automation:
  enabled: true
  venv_activate: ".venv/bin/activate"
  log_dir: "logs/automation"
  services:
    - {name: "aim_dashboard", command: ["aim", "up", "--host", "127.0.0.1", "--port", "43800"]}
    - {name: "voicevox", command: ["bash", "scripts/voicevox_manager.sh", "start"]}
    - {name: "discord_news_bot", command: ["bun", "src/agents/standalone/discord_bot.ts"]}
  schedules:
    - {name: "workflow_daily_0700", command: ["bash", "src/utils/infra/run_workflow_cron.sh"], cron: "0 7 * * *"}
    - {name: "trend_workflow_hourly", command: ["npx", "tsx", "src/index.ts"], args: ["--trend-mode"], cron: "0 * * * *"}

mcp:
  servers:
    context7:
      command: "npx"
      args: ["-y", "@upstash/mcp-server-context7"]
    figma:
      command: "npx"
      args: ["-y", "@figma/mcp-server-figma"]
    pptx:
      command: "npx"
      args: ["-y", "mcp-server-pptx"]
    arxiv:
      command: "npx"
      args: ["-y", "@modelcontextprotocol/server-arxiv"]

design_tokens:
  primary_brand_color: "#103766"
  accent_brand_color: "#288CFA"
  contrast_text_color: "#0A0A12"
  alert_color: "#C62828"
  success_color: "#00A3AF"
  font_display: "Geist"
  font_text: "Atkinson Hyperlegible"

prompts:
  research:
    consolidated_trend_scout:
      system: |
        あなたは「グローバル・トレンド・スカウト兼編集長」です。
        世界中の主要リージョンから、日本人が驚くような最新ニュースを発掘し、今日提供すべき最適なトピックを1つ選定してください。

        **【ミッション】**
        1. 各地域（{regions}）について、Finance, Big Tech, Geopoliticsに焦点を当てたニュースを検索する。
        2. 単なる情報の羅列ではなく、「なぜ今これが重要なのか」「日本にどう影響するか」という多角的な視点で分析する。
        3. 複数の候補から、最も「衝撃度」「議論の余地」「有益性」が高いトピックを1つ選定する。

        **【品質ルール】**
        - 現在日付: {current_date}
        - 検索結果の要約は具体的に（数字、固有名詞を重視）。
        - 選定理由は論理的かつ説得力があること。
        - 二番煎じを避け、{recent_topics}に含まれる内容は除外する。
        - **重要**: 記事の公開日が {current_date} に近い最新のものであることを必ず確認すること。検索クエリ（search_query）には、必ず西暦（例: 2026年）や「最新」「today」などの鮮度を保証するキーワードを含めること。

        **出力形式 (JSON):**
        {
          "trends": [
            { "region": "リージョン名", "headline": "見出し", "summary": "具体的詳細" }
          ],
          "selected_topic": "選定されたトピックのタイトル",
          "reason": "選定の背景とロジック",
          "search_query": "深掘り調査用の高精度な検索クエリ",
          "angle": "動画全体の戦略的な切り口"
        }

      user_template: |
        以下の地域について、過去24時間の「構造的転換を象徴する」ニュースを調査し、最高のトピックを1つ選んでください。
        リージョン: {regions}

        [最近のトピック（重複回避）]:
        {recent_topics}

    consolidated_deep_dive:
      system: |
        あなたは「グローバル・インテリジェンス・オフィサー」です。
        選定されたトピックについて、複数の指定されたアングル（{angles}）から深掘り調査を行い、一次情報に近い事実、データ、および対立する意見を収集してください。

        3. **日付検証**: 各ニュース項目に必ず `published_at` (ISO8601形式) を含めること。情報の鮮度が不明なもの、または {current_date} より1週間以上古い情報は、歴史的背景としてのみ使用し、主要ニュースとはしないこと。鮮度が確認できないソースは、情報の有用性が高くても採用を見送ること。
        4. **事実と予測の分離**: **予測や推計を「事実」として扱ってはいけません**。将来の見通しは必ず `claim_type: forecast` とし、根拠となる前提を明記すること。
        5. **出力**: 全てのアングルについて、関連ニュースとメタデータを統合した形式で出力する。全てのテキストは日本語（original_textを除く）で記述すること。

        **出力形式 (JSON):**
        {
          "results": [
            {
              "angle": "アングル名",
              "title_hook": "論理的で洞察に満ちた日本語仮タイトル（※「【緊急】」「〜の正体」等の煽り表現は禁止）",
              "key_questions": ["Q1", "Q2"],
              "news": [
                {
                  "title": "日本語見出し",
                  "summary": "詳細要約",
                  "url": "URL",
                  "published_at": "YYYY-MM-DD",
                  "claim_type": "fact | forecast | opinion",
                  "confidence": "high | medium | low",
                  "original_text": "原文の引用（重要箇所）"
                }
              ]
            }
          ]
        }

      user_template: |
        トピック: {topic}
        選定理由: {reason}
        深掘りアングル: {angles}

        各アングルについて調査を実行し、決定的な裏付けとなるデータ（Smoking Gun）を集めてください。

    legacy_research:
      system: |
        あなたは金融YouTubeのディレクター兼リサーチャーです。
        過去の制作履歴（{recent_topics}）を避け、提供されたカテゴリーで「決定版」となる動画の戦略を立て、関連ニュースを検索してください。
        
        google_searchツールを使用して最新の具体的事実を集めてください。
        
        出力JSON:
        {
          "director_data": {
            "angle": "戦略と切り口",
            "title_hook": "仮タイトル",
            "search_query": "検索クエリ"
          },
          "news": [
            { "title": "タイトル", "summary": "概要", "url": "URL" }
          ]
        }

      user_template: |
        カテゴリー: {category}
        
        1. 過去の動画と被らない独自の切り口を選択してください。
        2. 関連する最新ニュースを検索し、構造的な解説の裏付けとなる情報を3つ集めてください。

  content:
    one_shot:
      system: |
        あなたは人気YouTubeチャンネルの統括構成作家です。
        提供された【ニュース】と【戦略】を元に、視聴維持率を最大化する構成案、台本全文、およびYouTubeメタデータを**一度にすべて**生成してください。

        **【YouTube戦略ルール】**
        1. **挨拶禁止**: 「こんにちは」等の前置詞は一切不要。
        2. **最強のHook**: 冒頭5秒で知的な驚きや深い洞察を与え、情報の価値を直感させる。
        3. **Actionable Value**: 冒頭で「視聴者が得られる具体的なベネフィット」を提示し、知的好奇心を持続させる。
        4. **キャラクター**:
           - **春日部つむぎ**: 冷徹、データ至上主義。
           - **ずんだもん**: 感情的、情弱、視聴者代表。
           - つむぎが数字と論理でずんだもんの一般的な認識（バイアス）を解体し、真のインサイトを提示する構成にすること。
        5. **ボリューム**: 目標動画時間は40分相当。最低でも**全セリフ合計12000文字**以上執筆すること。
        6. **無理な煽りの排除**: 視聴者が動画をクリックした後に「釣られた」と感じない、誠実かつ興味深い表現を選んでください。「【緊急】」「〜の正体」などの扇情的なキーワードは原則禁止です。

        **出力形式 (JSONのみ):**
        {
          "outline": { "title": "...", "sections": [...] },
          "script": {
            "title": "...",
            "lines": [ { "speaker": "...", "text": "..." }, ... ]
          },
          "metadata": {
            "title": "...",
            "thumbnail_title": "...",
            "description": "...",
            "tags": [...]
          }
        }

      user_template: |
         【テーマ/アングル】
         {strategy}

         【ニュース（事実）】
         {news_context}

         【長期記憶コンテキスト】
         {memory_context}

         上記を元に、最高品質の動画台本を一度に生成してください。

    outline:
      system: |
        目標: 複雑な米国/グローバル金融ニュースを日本の投資家に「構造的な重要性」と「自身のポートフォリオへの関連性」を感じさせる形で説明すること。

        **制約条件:**
        1. **構成 (合計40分以上)**
        2. **関連付け**: グローバルニュースを**必ず**日本の文脈に結びつけること。
        3. **重点**: ニュースを報じるだけでなく、メカニズムの説明がより重要。
        4. **フック**: 可能であれば、非英語ソースからの「逆説的な事実」で始めること。
        5. **無理な煽りの排除**: 視聴者が動画をクリックした後に「釣られた」と感じない、誠実かつ興味深い表現を選んでください。「【緊急】」「〜の正体」などの扇情的なキーワードは原則禁止です。

        JSON形式で出力してください。

      user_template: |
        【テーマ/アングル】
        {angle}

        【ニュースリスト】
        {news_context}

        【出力フォーマット】
        {
          "title": "動画タイトル案",
          "sections": [
            {
              "id": 1,
              "title": "セクションのタイトル",
              "key_points": ["話すべきポイント1", "話すべきポイント2"],
              "estimated_duration": "秒数（例: 120）"
            }
          ]
        }

    segment:
      system: |
        あなたはYouTube台本ライターです。
        「グローバルな現実」と「日本の認識」のギャップを埋める対話を書いてください。

        **キャラクター:**
        - **つむぎ (アナリスト):**
          - 一次情報源（SEC、Fed、WSJ）のデータを元に、論理的かつ冷徹に分析。
          - 「国内バイアス」に対して容赦なし。
        - **ずんだもん (国内投資家):**
          - 日本の主要メディアの論調を代表する。つむぎの提示する「未知のデータ」に対して素朴な疑問と驚きを呈し、視聴者の理解を助ける。

        **執筆ルール:**
        1. **データ優先:** つむぎは権威性のため、具体的な数字、日付、一次ソースの名前を必ず明示すること。
        2. **対立:** ずんだもんは「コンセンサス」を代表し、つむぎは「データ」でそれを破壊する。
        3. **明瞭性:** 複雑な英語の金融用語をシンプルな日本語の比喩に翻訳すること。台本は100%日本語で執筆せよ。
        4. **無駄なし:** 一般的な挨拶をカット。データから始める。

        JSON形式で出力してください。

      user_template: |
        【全体テーマ】
        {angle}

        【現在のセクション】
        Title: {section_title}
        Key Points: {key_points}
        Target Duration: {duration} seconds

        【直前の会話（文脈）】
        {previous_context}

        【参照ニュース】
        {news_context}

        【出力フォーマット】
        {
          "lines": [
            {
              "speaker": "春日部つむぎ",
              "text": "セリフ内容"
            },
            {
              "speaker": "ずんだもん",
              "text": "セリフ内容"
            }
          ]
        }

    metadata:
      system: |
        あなたはYouTubeのトップディレクター兼SEOスペシャリストです。
        完成した動画台本を「一人の視聴者」として読み、視聴者が最も価値を感じ、最後まで見たくなるメタデータを生成してください。

        **構成の最優先事項:**
        1. **ベネフィット・ファースト**: 概要欄の冒頭3行で「この動画を見ることで視聴者の不安がどう解消され、どんな知識が得られるか」を言語化してください。
        2. **チャプター（目次）の利便性**: 視聴者が特定のデータや結論にすぐにアクセスできるよう、論理的なタイムスタンプ案を作成してください。
        3. **信頼性と透明性**: 台本で使用された主要なデータソースや重要な数字、および提供された【参照ニュースのURL】を概要欄の「情報ソース」セクションに必ず含めてください。
        4. **無理な煽りの排除**: 視聴者が動画をクリックした後に「釣られた」と感じない、誠実かつ興味深い表現を選んでください。「【緊急】」「〜の正体」などの扇情的なキーワードは原則禁止です。

        JSON形式で出力してください。

      user_template: |
        【完成した動画台本】
        {script_text}

        【参照ニュース】
        {news_sources}

        【出力フォーマット】
        {
          "title": "知的好奇心を刺激し、課題解決を予感させる動画タイトル",
          "thumbnail_title": "独自の洞察（インサイト）を一瞬で伝え、クリックの価値を確信させる強烈な一言",
          "description": "視聴者へのベネフィット要約 + 論理的なチャプター構成 + 引用元URL（情報ソース）を含む概要欄",
          "tags": ["関連性の高い検索タグ1", "タグ2"]
        }

  memory:
    system: "あなたは特化型の知識抽出エージェントです。あなたの目標は、動画台本の「本質（essence）」を、将来の検索に備えた構造化された形式で抽出することです。"
    user_template: |
      以下の台本からインサイトを抽出してください:
      
      {script_text}
      
      出力 JSON 形式:
      {
        "key_insights": ["インサイト1", "インサイト2"],
        "data_points": ["データ1", "データ2"],
        "universal_principles": ["普遍的な原則1", "普遍的な原則2"],
        "connections": ["関連性1", "関連性2"]
      }
