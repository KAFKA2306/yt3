# 次世代動画生成プラットフォーム「YT3」開発・運用指針
## 〜 開発プロトコル、ワークフロー、およびエージェント統合アーキテクチャの詳説 〜

### 第1章：プロジェクトの理念と背景

本プロジェクト「YT3」は、AIエージェントを活用した自動動画生成・投稿プロセスの効率を極限まで高め、高品質なコンテンツを継続的に提供することを目的に設計されました。現代のソフトウェア開発において、コードベースの肥大化は「複雑性」という課題を招き、メンテナンス性を著しく低下させます。本プロジェクトでは、この課題に対し、「最小化（Minimize）」と「堅牢な動作の維持」を根底に据えた開発哲学を採用しています。

本ドキュメントは、定義されたすべての要件を網羅し、その設計思想と実装詳細を詳説するものです。これは単なるマニュアルではなく、本システムがいかにして「最小のコードで最大の価値」を生み出すか、その指針を明確に示すためのものです。

---

### 第2章：8つの基本指針（The 8 Core Guidelines）の詳説

本プロジェクトに従事するすべての開発者（AIエージェントを含む）は、以下の8つの「開発指針」を遵守する必要があります。

#### 1. 最小化 (Minimize)
「コード量は少ないほど良い」という認識を徹底してください。コード量が増えるほどバグの混入リスクが高まり、テスト負荷が増大し、開発速度が低下します。機能を実装する際は、常にその必要性を問い直し、不要なオプションや過度な例外処理を削ぎ落としてください。ライブラリ選定においても、単機能で軽量なものを優先します。

#### 2. 重複排除 (DRY - Don't Repeat Yourself)
「重複したコードは負債の源である」と考えます。同様のロジックが複数箇所に現れた場合は、速やかに共通化を検討してください。特に、主要な共通ロジック、設定、ユーティリティは、原則として `src/core.ts` に集約します。一つの修正がシステム全体に正しく波及するよう、信頼できる唯一の情報源（Single Source of Truth）を維持します。

#### 3. 設定駆動 (Config-Driven)
ハードコーディングや環境依存の定数は、コードの柔軟性を損ないます。すべてのパラメータは `config/*.yaml` から読み込み、`src/core.ts` を通じて各モジュールへ提供してください。コードを変更することなく、設定ファイルの修正のみでシステムの動作を最適化できる状態を目指します。

#### 4. 変数・関数名による自己記述 (Self-Documenting Code)
「適切に記述されたコードは、それ自体が最良のドキュメントである」という信念に基づき、コード内の解説コメントは最小限に抑えます。詳細な説明が必要と感じる場合は、命名の最適化やロジックの単純化に向けたリファクタリングを検討してください。ただし、JSDoc による型情報の補足や、AI エージェントへの指示として機能する特定のマークアップは推奨されます。

#### 5. Fail Fast (異常の即時検知)
広すぎる `try-catch` ブロックは、システムの不整合を隠蔽し、問題特定を困難にします。「異常が発生した場合は即座に停止させる」という思想に従い、問題を早期に発見できる設計を心がけてください。エラーをキャッチして何事もなかったかのように動作を継続させることは、根本的な解決を先送りする結果となります。

#### 6. 基底クラスの継承 (Inheritance)
エージェントの振る舞いを統一するため、すべてのエージェントクラスは `BaseAgent` (`src/core.ts`) を継承してください。これにより、ロギング、エラー通知、リソース管理などの共通機能が一貫して適用されます。

#### 7. 日本語によるドキュメント作成 (Docs)
ドキュメントの多言語化による情報の不一致を避けるため、本プロジェクトでは、すべての公式ドキュメントおよびワークフローの説明を「日本語のみ」で記述することを原則としています。これにより、コミュニケーションコストの最小化と、確実な文脈共有を実現します。

#### 8. 型安全性の徹底 (No any)
TypeScript を使用する以上、型安全性は最大限に活用されるべきです。`any` 型の使用は、静的解析による恩恵を無効化し、予期せぬ実行時エラーを引き起こす主要な原因となります。すべてのデータ構造に対して、適切な型定義を行ってください。

---

### 第3章：統合 Git ワークフロー

開発者がリポジトリに対して行うべき基本操作を、ワークフロー `/git` に集約しました。

#### ワークフローの構成要素

1. **現状の把握 (Status & Log)**
   まず、現在のブランチの状態や変更内容を確認します。不適切なブランチでの作業や、保存漏れを未然に防ぐ重要なステップです。

2. **品質の検証 (Verify)**
   コミット前に、必ず `task lint` を実行し、コードの品質（型安全性や規約への適合）を検証します。また、ユニットテストによって、変更が既存の挙動に悪影響を与えていないかを確認します。

3. **反映と同期 (Sync)**
   検証済みの変更をステージングし、適切なメッセージと共にコミットして、リモートリポジトリへプッシュします。

4. **継続的インテグレーションの確認 (CI Status)**
   プッシュ後は `gh runs list` を活用し、リモート環境でのビルドやテストが正常に完了することを確認します。

---

### 第4章：技術スタックの選定理由

採用している技術スタックは、「開発スピード」と「表現力」のバランスを追求したものです。

#### AI 推論：Gemini 3 Flash
本プロジェクトの中核となる LLM として、`gemini-3-flash-preview` を採用しています。応答速度の速さ、高いマルチモーダル理解力、そして広大なコンテキストウィンドウが、エージェント間の長大な対話を正確に処理するために最適であると判断しました。

#### ワークフロー制御：LangGraph.js
循環グラフを用いた高度な意思決定プロセスを実現するため、LangGraph.js を採用しました。状態（State）を保持し、必要に応じて過去のステップに戻るなどの自律的な振る舞いを可能にします。

#### 音声合成：Voicevox
視聴者の継続率に大きく影響する音声品質を確保するため、Voicevox を採用しました。API を通じてキャラクター性の豊かな音声を動的に生成します。

#### メディアレンダリング：FFmpeg & Sharp
動画・画像の生成には、高パフォーマンスな FFmpeg と Sharp を使用しています。GPU 加速などを活用した構成により、レンダリング時間の短縮を図っています。

---

### 第5章：エージェント・アーキテクチャ

YT3 は、役割の異なる複数の自律エージェントが連携して動作します。

- **TrendScout (戦略・調査)**: 
  RSS やニュースサイトから最新トレンドを収集・分析し、動画の企画案を作成します。多言語情報を日本向けに整理する重要な役割を担います。
  
- **ScriptSmith (台本・SEO)**: 
  企画に基づき、魅力的な掛け合いの台本と、検索エンジンに最適化されたメタデータを作成します。

- **VisualDirector (制作・構築)**: 
  台本に基づき音声・画像を合成し、字幕や BGM を組み合わせて最終的な動画ファイルを生成します。

- **PublishAgent (配信・拡散)**: 
  完成した動画をプラットフォームへアップロードし、SNS での拡散や初期反応のフィードバックを行います。

---

### 第6章：運用監視と品質管理

自動実行されるシステムにおいて、品質の維持と異常の早期発見は極めて重要です。

#### 1. 自己監視 (Self-Monitoring)
各エージェントは詳細な実行ログを出力し、異常を即座に報告します。

#### 2. システム監視
依存サービスの稼働状況や API のレート制限を定期的に確認し、必要に応じて自動復旧や管理者への通知を行います。

#### 3. 品質評価ループ (CriticAgent)
専用の評価エージェントが、生成物の品質を多角的にスコアリングします。基準に満たないものは自動的に修正フェーズへ戻され、高品質な出力が保証されます。

---

### 第7章：データ管理と永続化

#### AssetStore
生成されたメディア素材はハッシュ値に基づき管理され、重複生成を回避してストレージ効率を高めています。

#### State Management
LangGraph のステートはフェーズごとに保存され、予期せぬ停止が発生しても、中断した地点から正確に再開（Resume）できる設計となっています。

---

### 第8章：詳細技術仕様

#### A1. プロンプト構成
ハルシネーション（誤情報の生成）を最小化するため、プロンプトはドメインのサンプリング、基本制約の適用、および JSON スキーマへのマッピングからなる多段階構成としています。

#### A2. メディア合成の同期
音声の尺、テキストの長さ、および再生速度の変数に基づき、字幕の表示時間を動的に算出することで、映像と音声の高度な整合性を保ちます。

#### A3. キャッシュ管理
ロジックの変更、設定の変更、および入力ソースの更新を検知するハッシュベースのキャッシュ機構により、生成効率と正確性を両立させています。

#### A4. API 再試行戦略
API エラーに対しては、指数関数的バックオフを用いた制御を行い、インフラへの負荷を分散させながら安定した接続を維持します。

---

### 第9章：プロジェクトの継承へ向けて

YT3 のコードベースは、自律化と効率化の追求から生まれた資産です。開発においては常に基本指針を意識し、安易な解決策ではなく、洗練された設計を追求してください。

指針に従い、不要を削ぎ落とすことで、システムはよりシンプルで力強いものへと進化します。この詳細なガイドラインが、あなたの開発の一助となり、YT3 の継続的な成功に寄与することを願っています。

**YT3 v1.0.0 - Project Genesis**
**Pursuit of Minimalist Excellence.**
